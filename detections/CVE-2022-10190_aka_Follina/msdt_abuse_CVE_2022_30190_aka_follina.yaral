rule msdt_abuse_CVE_2022_30190_aka_follina {
  meta:
    author = "Dan Lussier"
    description = "Detect msdt.exe spawning from office products"
    version = "1.0"
    severity = "High"
    mitre_TA = "TA0005"
    mitre_T1 = "T1218"
    mitre_url = "https://attack.mitre.org/techniques/T1218/"
    references = "https://msrc-blog.microsoft.com/2022/05/30/guidance-for-cve-2022-30190-microsoft-support-diagnostic-tool-vulnerability/"

  events:

    $e1.metadata.event_type = "PROCESS_LAUNCH"
        $e1.principal.process.file.full_path = /.*(winword|excel|outlook|powerpnt)\.exe/ nocase
        $e1.target.process.file.full_path = /.*msdt.exe/ nocase
    $e1.principal.hostname = $hostname

  match:
   $hostname over 1m

  condition:
   $e1
}